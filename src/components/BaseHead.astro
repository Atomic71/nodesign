---
import { languages, defaultLanguage, type Language } from '@utils/config';
import { SITE_TITLE, SITE_DESCRIPTION } from '@utils/consts';
import { getContent } from '@utils/contentLoader';

// Determine the current language and path
const currentPath = Astro.url.pathname;
const langFromUrl = currentPath.split('/')[1] as Language;
const lang = languages.includes(langFromUrl) ? langFromUrl : defaultLanguage;

console.log(`Current language: ${lang}`);
console.log(`Current path: ${currentPath}`);
// Load content based on the current path
const pageContent = await getContent(currentPath);

// Use frontmatter if available, otherwise fall back to default props
const title = pageContent?.frontmatter.title || SITE_TITLE;
const description = pageContent?.frontmatter.description || SITE_DESCRIPTION;
const image = pageContent?.frontmatter.image || '/default-og-image.jpg';

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<meta charset='UTF-8' />
<meta
  name='viewport'
  content='width=device-width'
/>
<link
  rel='icon'
  type='image/svg+xml'
  href='/favicon.svg'
/>
<meta
  name='generator'
  content={Astro.generator}
/>

<title>{title}</title>
<meta
  name='title'
  content={title}
/>
<meta
  name='description'
  content={description}
/>

<link
  rel='canonical'
  href={canonicalURL}
/>

<!-- Open Graph / Facebook -->
<meta
  property='og:type'
  content='website'
/>
<meta
  property='og:url'
  content={Astro.url}
/>
<meta
  property='og:title'
  content={title}
/>
<meta
  property='og:description'
  content={description}
/>
<meta
  property='og:image'
  content={new URL(image, Astro.url)}
/>

<!-- Twitter -->
<meta
  property='twitter:card'
  content='summary_large_image'
/>
<meta
  property='twitter:url'
  content={Astro.url}
/>
<meta
  property='twitter:title'
  content={title}
/>
<meta
  property='twitter:description'
  content={description}
/>
<meta
  property='twitter:image'
  content={new URL(image, Astro.url)}
/>

<!-- Alternate language versions -->
{
  languages.map((l) => (
    <link
      rel='alternate'
      hreflang={l}
      href={
        new URL(
          `/${l}${Astro.url.pathname.replace(/^\/[^\/]+/, '')}`,
          Astro.site
        )
      }
    />
  ))
}
<link
  rel='alternate'
  hreflang='x-default'
  href={new URL(
    `/${defaultLanguage}${Astro.url.pathname.replace(/^\/[^\/]+/, '')}`,
    Astro.site
  )}
/>

<!-- Add your custom fonts here -->
<link
  href='https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap'
  rel='stylesheet'
/>

<!-- Optional: Add your analytics or other scripts here -->
